CURRENCY="",$(document).ready(function(){var t=BASE_URL+"/assets/image/crossword.png";$("body").css("background-image","url("+t+")"),Utils.loadCurrency(),Utils.setInvoiceDate(),Utils.setInvoiceDueDate(),$(document).on("change",'input[type="file"][name="upload-logo"]',Utils.uploadLogo),$(document).on("click","a.remove-logo",Utils.removeLogo),$(document).on("click",".add-line-item",Utils.addNewLineItem),$(document).on("click",".delete-line-item",Utils.deleteLineItem),$(document).on("change",'select[name="currency"]',Utils.setCurrency),$(document).on("keyup",'input[type="number"][name="quantity"],input[type="number"][name="unit-price"],input[type="text"][name="tax"]',Utils.lineItemTotal),$(document).on("click",'button[type="button"][name="add-amt-paid"],button[type="button"][name="remove-amt-paid"]',Utils.toggleAmountPaid),$(document).on("click",'button[type="button"][name="add-discount"],button[type="button"][name="remove-discount"]',Utils.toggleDiscount),$(document).on("click",'button[type="button"][name="add-shipping"],button[type="button"][name="remove-shipping"]',Utils.toggleShipping),$(document).on("click",'button[type="button"][name="add-tax"]',Utils.addTax),$(document).on("click","a.delete-tax",Utils.removeTax),$(document).on("keyup",'input[name="amount-paid-value"], input[name="discount-value"], input[name="shipping-value"], input[name="tax-value"]',Utils.calculateTotal),$(document).on("click",'button[name="download-invoice"]',Utils.generatePDF),$(".currency").html("INR")}),Utils={loadCurrency:function(){$.ajax({dataType:"json",url:BASE_URL+"/assets/js/currency.json",data:"",success:function(t){$.each(t,function(t,e){var a=$(document.createElement("option"));a.val(t),a.attr("data-currency",e.currency_code),a.html(e.country+"  ( "+e.currency_code+" ) "),45==t&&a.attr("selected","selected"),$('select[name="currency"]').append(a)})}})},uploadLogo:function(){var t=new FormData;t.append("file",$("#upload-logo").get(0).files[0]),$.ajax({type:"POST",url:BASE_URL+"/ajax.php",data:t,cache:!1,contentType:!1,processData:!1,mimeType:"multipart/form-data",success:function(t){$("#logoWrapper").append(t)}})},removeLogo:function(t){$(t.currentTarget).parents("#logoContainer").remove()},addNewLineItem:function(t){t.preventDefault();var e=$("table.item-table tbody tr:first").clone();e.find("input").val(""),$(".item-table tbody").append(e)},deleteLineItem:function(t){t.preventDefault(),$(t.currentTarget).parents("tbody").children("tr").length>1?$(t.currentTarget).parents("tr").remove():$(t.currentTarget).parents("tr").find("input").val(""),Utils.calculateTotal(t)},setInvoiceDate:function(){var t=new Date,e=("0"+t.getDate()).slice(-2),a=("0"+(t.getMonth()+1)).slice(-2),n=t.getFullYear()+"-"+a+"-"+e;$('input[type="date"][name="date"]').val(n)},setInvoiceDueDate:function(){var t=new Date;t.setDate(t.getDate()+15);var e=("0"+t.getDate()).slice(-2),a=("0"+(t.getMonth()+1)).slice(-2),n=t.getFullYear()+"-"+a+"-"+e;$('input[type="date"][name="due-date"]').val(n)},changeCurrency:function(t){var e=$(t.currentTarget).find("option:selected").data("currency");$(".currency").html(e),CURRENCY=e},lineItemTotal:function(t){var e=parseFloat($(t.currentTarget).parents("tr").find('input[name="quantity"]').val()),a=parseFloat($(t.currentTarget).parents("tr").find('input[name="unit-price"]').val()),n=e*a;isNaN(n)&&(n=0),$(t.currentTarget).parents("tr").find('input[type="text"][name="total"]').val(n.toFixed(2)),Utils.calculateTotal(t)},toggleAmountPaid:function(t){$(t.currentTarget).toggleClass("btn-danger");var e=$(t.currentTarget).attr("name");if("add-amt-paid"==e){$(t.currentTarget).attr("name","remove-amt-paid"),$(t.currentTarget).html('<i class="fa fa-money"></i> Remove Amount Paid');var a=$(document.createElement("tr"));a.append('<td colspan="2"></td><td colspan="2"><input type="text" class="form-control" name="amount-paid-label" value="Amount Paid"></td><td><input type="text" name="amount-paid-value" class="form-control  additional" placeholder="0.00"></td>'),$(".item-table tfoot tr:first").after(a)}else"remove-amt-paid"==e&&($(t.currentTarget).attr("name","add-amt-paid"),$(t.currentTarget).html('<i class="fa fa-money"></i> Add Amount Paid'),$('input[type="text"][name="amount-paid-value"]').parents("tr").remove(),Utils.calculateTotal(t))},toggleShipping:function(t){$(t.currentTarget).toggleClass("btn-danger");var e=$(t.currentTarget).attr("name");if("add-shipping"==e){$(t.currentTarget).attr("name","remove-shipping"),$(t.currentTarget).html('<i class="fa fa-truck"></i> Remove Shipping');var a=$(document.createElement("tr"));a.append('<td colspan="2"></td><td colspan="2"><input type="text" class="form-control" name="shipping-label" value="Shipping"></td><td><input type="text" name="shipping-value" class="form-control  additional" placeholder="0.00"></td>'),$(".item-table tfoot tr:first").after(a)}else"remove-shipping"==e&&($(t.currentTarget).attr("name","add-shipping"),$(t.currentTarget).html('<i class="fa fa-truck"></i> Add Shipping'),$('input[type="text"][name="shipping-value"]').parents("tr").remove(),Utils.calculateTotal(t))},toggleDiscount:function(t){$(t.currentTarget).toggleClass("btn-danger");var e=$(t.currentTarget).attr("name");if("add-discount"==e){$(t.currentTarget).attr("name","remove-discount"),$(t.currentTarget).html('<i class="fa fa-tag"></i> Remove Discount');var a=$(document.createElement("tr"));a.append('<td colspan="2"></td><td colspan="2"><input type="text" class="form-control" name="discount-label" value="Discount"></td><td><input type="text" name="discount-value" class="form-control  additional" placeholder="0.00"></td>'),$(".item-table tfoot tr:first").after(a)}else"remove-discount"==e&&($(t.currentTarget).attr("name","add-discount"),$(t.currentTarget).html('<i class="fa fa-tag"></i> Add Discount'),$('input[type="text"][name="discount-value"]').parents("tr").remove(),Utils.calculateTotal(t))},addTax:function(){var t=$(document.createElement("tr"));t.append('<td><a href="javascript:void(0)" class="delete-tax"><i class="fa fa-trash fa-2x text-danger"></i></a></td><td></td><td colspan="2"><input type="text" class="form-control" name="tax-label" value="Tax"></td><td><input type="text" name="tax-value" class="form-control  additional" placeholder="0.00"></td>'),$(".item-table tfoot tr:first").after(t)},removeTax:function(t){$(t.currentTarget).parents("tr").remove(),Utils.calculateTotal(t)},setCurrency:function(){var t=$('select[name="currency"] option:selected').data("currency");$(".currency").html(t)},calculateTax:function(t){var e=0,a=parseFloat($('input[type="text"][name="sub-total"]').val()),n=$(t.currentTarget).val();e=-1===n.indexOf("%")?parseFloat(n):a*parseFloat(n)/100,isNaN(e)&&(e=0)},calculateTotal:function(){var t=0;$(".item-table tbody tr").each(function(){t+=parseFloat($(this).find('input[type="text"][name="total"]').val())}),isNaN(t)&&(t=0),$('input[type="text"][name="sub-total"]').val(t.toFixed(2));var e=0,a=0;$(".item-table tbody tr").each(function(){{var t=0;parseFloat($(this).find('input[name="quantity"]').val()),parseFloat($(this).find('input[name="unit-price"]').val()),$(this).find('input[name="tax"]').val()}a+=t});var n=0;$('input[type="text"][name="tax-value"]').length&&$('input[type="text"][name="tax-value"]').each(function(){var e=0,a=$(this).val();e=-1===a.indexOf("%")?parseFloat(a):t*parseFloat(a)/100,isNaN(e)&&(e=0),n+=e}),e=n+a,$('input[type="text"][name="tax-total"]').val(e.toFixed(2));var i=0;if($('input[name="shipping-value"]').length){var o=$('input[type="text"][name="shipping-value"]').val();i=-1===o.indexOf("%")?parseFloat(o):t*parseFloat(o)/100,isNaN(i)&&(i=0)}var l=0;if($('input[name="discount-value"]').length){var r=$('input[type="text"][name="discount-value"]').val();l=-1===r.indexOf("%")?parseFloat(r):t*parseFloat(r)/100,isNaN(l)&&(l=0)}var u=t+e+i-l;$('input[type="text"][name="gross-total"]').val(u.toFixed(2));var p=0;if($('input[name="amount-paid-value"]').length){var c=$('input[type="text"][name="amount-paid-value"]').val();p=-1===c.indexOf("%")?parseFloat(c):u*parseFloat(c)/100,isNaN(p)&&(p=0)}var d=u-p;$('input[type="text"][name="amount-due"]').val(d.toFixed(2)),null!=u||""!=u?$('button[type="button"][name="download-invoice"]').prop("disabled",!1):$('button[type="button"][name="download-invoice"]').prop("disabled",!0)},formatCurrency:function(t){var e=$('select[name="currency"] option:selected').data("currency");return e+" "+t},generatePDF:function(){invoiceObj=new Object,invoiceObj.invoiceTitle=$('input[type="text"][name="invoice-title"]').val(),invoiceObj.companyName=$('input[type="text"][name="company-name"]').val(),invoiceObj.add1=$('input[type="text"][name="add-line1"]').val(),invoiceObj.add2=$('input[type="text"][name="add-line2"]').val(),invoiceObj.city=$('input[type="text"][name="city"]').val(),invoiceObj.phone=$('input[type="number"][name="phone"]').val(),invoiceObj.logo=$('img[name="comp-logo"]').data("image-uri"),invoiceObj.invoiceLabel=$('input[type="text"][name="invoice-label"]').val(),invoiceObj.invoiceNumber=$('input[type="text"][name="invoice-number"]').val(),invoiceObj.dateLabel=$('input[type="text"][name="date-label"]').val(),invoiceObj.date=$('input[type="date"][name="date"]').val(),invoiceObj.dueDateLabel=$('input[type="text"][name="due-date-label"]').val(),invoiceObj.dueDate=$('input[type="date"][name="due-date"]').val(),invoiceObj.amountDueLabel=$('input[type="text"][name="amount-due-label"]').val(),invoiceObj.amountDue=Utils.formatCurrency($('input[type="text"][name="amount-due"]').val()),invoiceObj.to=$('input[type="text"][name="billto"]').val(),invoiceObj.bcompName=$('input[type="text"][name="bcompany-name"]').val(),invoiceObj.baddress=$('input[type="text"][name="baddress"]').val(),invoiceObj.bcity=$('input[type="text"][name="bcity"]').val(),invoiceObj.bphone=$('input[type="number"][name="bphone"]').val(),invoiceObj.sto=$('input[type="text"][name="shipto"]').val(),invoiceObj.scompName=$('input[type="text"][name="scompany-name"]').val(),invoiceObj.saddress=$('input[type="text"][name="saddress"]').val(),invoiceObj.scity=$('input[type="text"][name="scity"]').val(),invoiceObj.sphone=$('input[type="number"][name="sphone"]').val(),invoiceObj.footNote=$('textarea[name="comments"]').val(),invoiceObj.footer=$('input[type="text"][name="invoice-footer"]').val();var t=[];$("table.item-table").find("thead tr").each(function(){t.push({heading1:$(this).find('input[type="text"][name="heading-1"]').val(),heading2:$(this).find('input[type="text"][name="heading-2"]').val(),heading3:$(this).find('input[type="text"][name="heading-3"]').val(),heading5:$(this).find('input[type="text"][name="heading-5"]').val()})}),invoiceObj.thead=t;var e=[];$("table.item-table").find("tbody tr").each(function(){e.push({desc:$(this).find('input[type="text"][name="description"]').val(),quantity:$(this).find('input[type="number"][name="quantity"]').val(),unitPrice:$(this).find('input[type="number"][name="unit-price"]').val(),total:$(this).find('input[type="text"][name="total"]').val()})}),invoiceObj.tbody=e;var a=[];$("table.item-table").find("tfoot tr").each(function(t,e){stv=$(e).find('input[type="text"][name="sub-total"]').val(),null!=stv&&(stv=Utils.formatCurrency(stv)),ttv=$(e).find('input[type="text"][name="tax-total"]').val(),null!=ttv&&(ttv=Utils.formatCurrency(ttv)),gtv=$(e).find('input[type="text"][name="gross-total"]').val(),null!=gtv&&(gtv=Utils.formatCurrency(gtv)),a.push({stl:$(e).find('input[type="text"][name="sub-total-label"]').val(),stv:stv,ttl:$(e).find('input[type="text"][name="tax-total-label"]').val(),ttv:ttv,gtl:$(e).find('input[type="text"][name="gross-total-label"]').val(),gtv:gtv,tl:$(e).find('input[type="text"][name="tax-label"]').val(),tv:$(e).find('input[type="text"][name="tax-value"]').val(),apl:$(e).find('input[type="text"][name="amount-paid-label"]').val(),apv:$(e).find('input[type="text"][name="amount-paid-value"]').val(),dl:$(e).find('input[type="text"][name="discount-label"]').val(),dv:$(e).find('input[type="text"][name="discount-value"]').val(),sl:$(e).find('input[type="text"][name="shipping-label"]').val(),sv:$(e).find('input[type="text"][name="shipping-value"]').val()})}),invoiceObj.tfoot=a;var n=JSON.stringify(invoiceObj);Invoice.generateInvoicePDF(n)}};